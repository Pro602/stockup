<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</title>

    <!-- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö manifest.json -->
    <link rel="manifest" href="/stockup/manifest.json">

    <!-- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö favicon -->
    <link rel="icon" href="favicon.ico?v=2">

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

    <style>
    /* //‡πÑ‡∏Æ‡πÑ‡∏•‡πå row table */
        table.dataTable tbody tr:hover {
            background-color: #77fd29 !important;
            cursor: pointer;
        }
.logo {
            width: 80px;  /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î */
            height: auto;  /* ‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô */
            display: inline-block;
        }

        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(120deg, #a8edea, #fed6e3);
            padding: 20px;
        }
        
        h2 {
            color: #007BFF;
            font-size: 30px;
            font-weight: bold;
        }
        
        .filter-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        select {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #bbb;
            background: #fff;
            width: 200px;
        }
        
        table {
            width: 100%;
            margin-top: 10px;
        }
        
        th {
            background: #4CAF50;
            color: white;
        }
        
        th,
        td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        .dt-buttons {
            margin-bottom: 10px;
        }
        
        @media (max-width: 600px) {
            select {
                width: 100%;
            }
        }
    </style>
</head>

<body>

<h2>
        <img src="https://pro602.github.io/stockup/images/logo.png" class="logo" alt="Logo">
        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡∏Ñ‡∏•‡∏±‡∏á STOCK ON HAND
    </h2>
    <p id="lastUpdated">‚è≥ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>

    <div class="filter-container">
        <select id="categorySelect">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>
        </select>
        <select id="typeSelect">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
        </select>
    </div>

    <table id="productTable" class="display nowrap responsive" style="width:100%">
        <thead>
            <tr>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const sheetID = "1l1exJIhymKc3MaaYwnV6UKWP39Na3t_Y_ZYNvAW0FKY";
        const sheetName = "Stock";
        const apiUrl = `https://opensheet.elk.sh/${sheetID}/${sheetName}`;

        let dataTable;
        let dataStore = [];

        function loadSheetData() {
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    console.log("üìå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å API:", data);

                    // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ datetime ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏£‡∏Å
                    const rawDatetime = data.length > 0 ? data[0]["datetime"] : null;

                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ datetime ‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡∏°‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö
                    let formattedDatetime = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î";
                    if (rawDatetime) {
                        // ‡πÅ‡∏õ‡∏•‡∏á datetime ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å API
                        const dateObj = new Date(rawDatetime);

                        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ
                        const day = String(dateObj.getDate()).padStart(2, '0');
                        const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                        const year = dateObj.getFullYear();
                        const hours = String(dateObj.getHours()).padStart(2, '0');
                        const minutes = String(dateObj.getMinutes()).padStart(2, '0');
                        const seconds = String(dateObj.getSeconds()).padStart(2, '0');

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô dd/mm/yyyy hh:mm:ss
                        formattedDatetime = `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
                    }

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö dd/mm/yyyy hh:mm:ss
                    document.getElementById("lastUpdated").textContent = `‚è≥ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏ÅFomula‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${formattedDatetime}`;

                    dataStore = data;
                    updateFilters();
                    populateTable(data);
                })
                .catch(error => {
                    console.error("üö® ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", error);
                    document.getElementById("lastUpdated").textContent = "‚ùå ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
                });
        }


        function updateFilters() {
            const categorySelect = document.getElementById("categorySelect");
            const typeSelect = document.getElementById("typeSelect");

            categorySelect.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>`;
            typeSelect.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>`;

            const categories = [...new Set(dataStore.map(row => row["Category"]).filter(Boolean))];
            const types = [...new Set(dataStore.map(row => row["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"]).filter(Boolean))];

            categories.forEach(category => {
                let option = document.createElement("option");
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });

            types.forEach(type => {
                let option = document.createElement("option");
                option.value = type;
                option.textContent = type;
                typeSelect.appendChild(option);
            });
        }

        function populateTable(data) {
            if ($.fn.DataTable.isDataTable("#productTable")) {
                dataTable.clear().destroy();
            }

            const tableBody = document.querySelector("#productTable tbody");
            tableBody.innerHTML = "";

            data.forEach(row => {
                let tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${row["prodcode"]}</td>
                    <td>${row["prodname"]}</td>
                    <td>${row["qty"]}</td>
                    <td>${row["Category"]}</td>
                    <td>${row["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"]}</td>
                `;
                tableBody.appendChild(tr);
            });

            dataTable = $("#productTable").DataTable({
                responsive: true,
                pageLength: 10,
                ordering: true,
                searching: true,
                order: [
                    [0, 'desc']
                ],
                language: {
                    'search': '<i class="fa-solid fa-magnifying-glass"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:',
                    'lengthMenu': '‡πÅ‡∏™‡∏î‡∏á _MENU_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤',
                    'info': '‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ _PAGE_ ‡∏à‡∏≤‡∏Å _PAGES_',
                    'zeroRecords': '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                    'infoEmpty': '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏î‡πâ',
                    'infoFiltered': '(‡∏Å‡∏£‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î _MAX_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)',
                    'paginate': {
                        'next': '<em class="fa fa-caret-right"></em> ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ',
                        'previous': '<em class="fa fa-caret-left"></em> ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤'
                    }
                },
                lengthMenu: [
                    [10, 25, 50, -1],
                    [10, 25, 50, 'All']
                ],
                destroy: true,
                dom: '<"row"<"col-sm-12 col-md-6"B><"col-sm-12 col-md-6"f>>' +
                    '<"row"<"col-sm-12"tr>>' +
                    '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-5"l><"col-sm-12 col-md-2"p>>',
                buttons: [{
                    extend: 'copy',
                    text: 'üìã copy',
                    className: 'btn-info'
                }, {
                    extend: 'excelHtml5',
                    text: 'üìä Export Excel',
                    className: 'btn btn-success'
                }, {
                    extend: 'csvHtml5',
                    text: 'üìÑ Export CSV',
                    className: 'btn btn-info'
                }, {
                    extend: 'print',
                    text: 'üñ®Ô∏è Print',
                    className: 'btn btn-primary'
                }]
            });
        }

        function applyFilters() {
            const selectedCategory = document.getElementById("categorySelect").value;
            const selectedType = document.getElementById("typeSelect").value;

            let filteredData = dataStore;

            if (selectedCategory) {
                filteredData = filteredData.filter(row => row["Category"] === selectedCategory);
            }

            if (selectedType) {
                filteredData = filteredData.filter(row => row["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"] === selectedType);
            }

            populateTable(filteredData);
        }

        document.getElementById("categorySelect").addEventListener("change", applyFilters);
        document.getElementById("typeSelect").addEventListener("change", applyFilters);

        loadSheetData();
        setInterval(loadSheetData, 30000);
    </script>

</body>

</html>
